define("lytix_grademonitor/teachers-details",["exports","lytix_helper/widget","core/templates","lytix_helper/date_helper","lytix_helper/percent_rounder"],(function(_exports,_widget,_templates,_date_helper,_percent_rounder){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_widget=_interopRequireDefault(_widget),_templates=_interopRequireDefault(_templates),_percent_rounder=_interopRequireDefault(_percent_rounder);_exports.init=(contextid,userid,courseid,locale)=>{locale=_widget.default.convertLocale(locale);let valueCount=0;Promise.resolve(_widget.default.getData("local_lytix_lytix_grademonitor_grademonitor_get_history",{contextid:contextid,courseid:courseid})).then((data=>{const counts=data.Count;valueCount=counts.length;const studentCount=data.Total,weekCount=Math.round(valueCount/3),context={counts:Array(weekCount),labels:Array(weekCount).fill(!0),percentages:Array(weekCount),weeks:Array(weekCount-1),valueCount:valueCount-3},sumArray=array=>{let sum=0;for(let i=array.length-1;i>=0;--i)sum+=array[i];return sum},rounder=new _percent_rounder.default;for(let dataColumIndex=0,percentIndex=0;dataColumIndex<valueCount;++dataColumIndex){const currentCounts=counts[dataColumIndex],currentCountsLength=currentCounts.length;let countSum;if(currentCountsLength>0&&(countSum=sumArray(currentCounts))>0){const segments=context.counts[dataColumIndex]=[];let gradeIndex=currentCountsLength-1;do{const currentGradeCount=currentCounts[gradeIndex];currentGradeCount>0&&segments.push({count:currentGradeCount,percent:rounder.round(currentGradeCount/countSum*100),grade:gradeIndex+1})}while(--gradeIndex>=0);context.percentages[dataColumIndex]=Math.round(dataColumIndex%3==0?countSum/studentCount*100:data.Percentage[percentIndex++])}else context.counts[dataColumIndex]=!1,context.percentages[dataColumIndex]=!1,dataColumIndex%3&&percentIndex++;rounder.reset()}const startDate=new Date(1e3*data.Start);startDate.setUTCDate(startDate.getUTCDate()+4-(startDate.getUTCDay()||7));const yearStart=new Date(Date.UTC(startDate.getUTCFullYear(),0,1)),getCalendarWeek=()=>Math.ceil(((startDate-yearStart)/864e5+1)/7);for(let i=0,calendarWeek=getCalendarWeek(),dstIndex=weekCount;i<weekCount;++i)calendarWeek>52&&(startDate.setUTCDate(startDate.getUTCDate()+7*i),yearStart.setUTCFullYear(yearStart.getUTCFullYear()+1),calendarWeek=getCalendarWeek()),context.weeks[--dstIndex]=calendarWeek++;startDate.setTime(1e3*data.Start),startDate.setDate(startDate.getDate()+1-(startDate.getDay()||7));const endDate=new Date(startDate.getTime());endDate.setDate(endDate.getDate()+6+7*(weekCount-2));const{daysPerMonth:daysPerMonth,monthNames:monthNames}=(0,_date_helper.getDaysPerMonth)(startDate,endDate,new Intl.DateTimeFormat(locale,{month:"short"})),dayCount=sumArray(daysPerMonth),monthCount=monthNames.length,months=context.months=new Array(monthCount);for(let i=0,dstIndex=monthCount;i<monthCount;++i)months[--dstIndex]={width:rounder.round(daysPerMonth[i]/dayCount*100),month:monthNames[i]};return _templates.default.render("lytix_grademonitor/teachers-details",context)})).then((html=>{const container=_widget.default.getContentContainer("grademonitor");container.insertAdjacentHTML("beforeend",html);const segments=container.querySelectorAll(".grade-segment");for(let i=segments.length-1;i>=0;--i){const segment=segments[i];segment.scrollHeight>segment.clientHeight&&(segment.style.color="transparent")}})).finally((()=>{document.getElementById("grademonitor").classList.remove("loading")})).catch((error=>{_widget.default.handleError(error,"grademonitor")}))}}));

//# sourceMappingURL=teachers-details.min.js.map