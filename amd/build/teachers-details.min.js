define("lytix_grademonitor/teachers-details",["exports","lytix_helper/widget","core/templates","lytix_helper/date_helper","lytix_helper/percent_rounder"],(function(_exports,_widget,_templates,_date_helper,_percent_rounder){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_widget=_interopRequireDefault(_widget),_templates=_interopRequireDefault(_templates),_percent_rounder=_interopRequireDefault(_percent_rounder);_exports.init=function(contextid,userid,courseid,locale){locale=_widget.default.convertLocale(locale);var valueCount=0;Promise.resolve(_widget.default.getData("local_lytix_lytix_grademonitor_grademonitor_get_history",{contextid:contextid,courseid:courseid})).then((function(data){var counts=data.Count;valueCount=counts.length;for(var studentCount=data.Total,weekCount=Math.round(valueCount/3),context={counts:Array(weekCount),labels:Array(weekCount).fill(!0),percentages:Array(weekCount),weeks:Array(weekCount-1),valueCount:valueCount-3},sumArray=function(array){for(var sum=0,i=array.length-1;i>=0;--i)sum+=array[i];return sum},rounder=new _percent_rounder.default,dataColumIndex=0,percentIndex=0;dataColumIndex<valueCount;++dataColumIndex){var currentCounts=counts[dataColumIndex],currentCountsLength=currentCounts.length,countSum=void 0;if(currentCountsLength>0&&(countSum=sumArray(currentCounts))>0){var segments=context.counts[dataColumIndex]=[],gradeIndex=currentCountsLength-1;do{var currentGradeCount=currentCounts[gradeIndex];currentGradeCount>0&&segments.push({count:currentGradeCount,percent:rounder.round(currentGradeCount/countSum*100),grade:gradeIndex+1})}while(--gradeIndex>=0);context.percentages[dataColumIndex]=Math.round(dataColumIndex%3==0?countSum/studentCount*100:data.Percentage[percentIndex++])}else context.counts[dataColumIndex]=!1,context.percentages[dataColumIndex]=!1,dataColumIndex%3&&percentIndex++;rounder.reset()}var startDate=new Date(1e3*data.Start);startDate.setUTCDate(startDate.getUTCDate()+4-(startDate.getUTCDay()||7));for(var yearStart=new Date(Date.UTC(startDate.getUTCFullYear(),0,1)),getCalendarWeek=function(){return Math.ceil(((startDate-yearStart)/864e5+1)/7)},i=0,calendarWeek=getCalendarWeek(),dstIndex=weekCount;i<weekCount;++i)calendarWeek>52&&(startDate.setUTCDate(startDate.getUTCDate()+7*i),yearStart.setUTCFullYear(yearStart.getUTCFullYear()+1),calendarWeek=getCalendarWeek()),context.weeks[--dstIndex]=calendarWeek++;startDate.setTime(1e3*data.Start),startDate.setDate(startDate.getDate()+1-(startDate.getDay()||7));var endDate=new Date(startDate.getTime());endDate.setDate(endDate.getDate()+6+7*(weekCount-2));for(var _getDaysPerMonth=(0,_date_helper.getDaysPerMonth)(startDate,endDate,new Intl.DateTimeFormat(locale,{month:"short"})),daysPerMonth=_getDaysPerMonth.daysPerMonth,monthNames=_getDaysPerMonth.monthNames,dayCount=sumArray(daysPerMonth),monthCount=monthNames.length,months=context.months=new Array(monthCount),_i=0,_dstIndex=monthCount;_i<monthCount;++_i)months[--_dstIndex]={width:rounder.round(daysPerMonth[_i]/dayCount*100),month:monthNames[_i]};return _templates.default.render("lytix_grademonitor/teachers-details",context)})).then((function(html){var container=_widget.default.getContentContainer("grademonitor");container.insertAdjacentHTML("beforeend",html);for(var segments=container.querySelectorAll(".grade-segment"),i=segments.length-1;i>=0;--i){var segment=segments[i];segment.scrollHeight>segment.clientHeight&&(segment.style.color="transparent")}})).finally((function(){document.getElementById("grademonitor").classList.remove("loading")})).catch((function(error){_widget.default.handleError(error,"grademonitor")}))}}));

//# sourceMappingURL=teachers-details.min.js.map